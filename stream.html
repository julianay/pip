
<!DOCTYPE html>
<meta charset="utf-8">
<title>Streamgraph</title>
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}

button {
  position: absolute;
  right: 10px;
  top: 10px;
}

</style>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="d3/queue.v1.min.js"></script>
<div onload = "transition()"></div>
<script>

var stock1=[];
var stock2=[];
var stock3=[];
var stock4=[];
var stock5=[];
var allStocks = [stock1, stock2, stock3, stock4, stock5];
var format = d3.time.format("%m/%d/%y");

function createStock(x, y){
  var aData = {};
  aData.x = format.parse(x);
  aData.y = y;
  return aData;
}

queue()
  .defer(d3.json, "newData/p_aapl.json")
  .defer(d3.json, "newData/p_msft.json")
  .defer(d3.json, "newData/p_fb.json")
  .defer(d3.json, "newData/p_goog.json")
  .defer(d3.json, "newData/p_twtr.json")
  .await(ready);

function ready(error, vol1, vol2, vol3, vol4, vol5) { 
  
  for(var i=0; i < vol1.length; i++){
    //console.log(vol1[i].date)
    stock1.push(createStock(vol1[i].date, Math.abs(+(vol1[i].close) -(vol1[i].open))));
    stock2.push(createStock(vol1[i].date, Math.abs(+(vol2[i].close) -(vol2[i].open))));
    stock3.push(createStock(vol1[i].date, Math.abs(+(vol3[i].close) -(vol3[i].open))));
    stock4.push(createStock(vol1[i].date, Math.abs(+(vol4[i].close) -(vol4[i].open))));
    stock5.push(createStock(vol1[i].date, Math.abs(+(vol5[i].close) -(vol5[i].open))));
    
  }
  //console.log(stock1);


var n = 5, // number of layers
    m = 60, // number of samples per layer
    stack = d3.layout.stack().offset("wiggle"),
    layers0 = stack(d3.range(n).map(function(i) { return allStocks[i]; }));

var width = 960,
    height = 500;
/*
var x = d3.scale.linear()
    .domain([0, m - 1])
    .range([0, width]);
    */

var x = d3.time.scale()
    .range([0, width]);    

var y = d3.scale.linear()
    .domain([0, d3.max(layers0, function(layer) { return d3.max(layer, function(d) { return d.y0 + d.y; }); })])
    .range([height, 0]);

var color = d3.scale.linear()
    .range(["#000", "#eee"]);

var area = d3.svg.area()
    .x(function(d) { return x(d.x); })
    .y0(function(d) { return y(d.y0); })
    .y1(function(d) { return y(d.y0 + d.y); })
    .interpolate("basis");

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

svg.selectAll("path")
    .data(layers0)
  .enter().append("path")
    .attr("d", area)
    .style("fill", function() { return color(Math.random()); });

}    

function transition() {
  d3.selectAll("path")
      .data(function() {
        //var d = layers1;
        //layers1 = layers0;
        return layers0 = d;
      })
    .transition()
      .duration(2500)
      .attr("d", area);
}

</script>
